(function(t){function e(e){for(var a,o,s=e[0],u=e[1],c=e[2],f=0,d=[];f<s.length;f++)o=s[f],r[o]&&d.push(r[o][0]),r[o]=0;for(a in u)Object.prototype.hasOwnProperty.call(u,a)&&(t[a]=u[a]);l&&l(e);while(d.length)d.shift()();return i.push.apply(i,c||[]),n()}function n(){for(var t,e=0;e<i.length;e++){for(var n=i[e],a=!0,s=1;s<n.length;s++){var u=n[s];0!==r[u]&&(a=!1)}a&&(i.splice(e--,1),t=o(o.s=n[0]))}return t}var a={},r={app:0},i=[];function o(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=a,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)o.d(n,a,function(e){return t[e]}.bind(null,a));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],u=s.push.bind(s);s.push=e,s=s.slice();for(var c=0;c<s.length;c++)e(s[c]);var l=u;i.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"50db":function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e);n("cadf"),n("551c"),n("097d");var a=n("2b0e"),r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("MainPlayer"),n("div",{staticClass:"tip"},[t._v("请旋转屏幕")])],1)},i=[],o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:[t.isMobile?"mobile-player":"pc-player"]},[n("div",{staticClass:"left"},[n("div",{staticClass:"direction-pad"},[n("div",{staticClass:"line"},[n("button",{staticClass:"pad-button",attrs:{"data-key":"left"},on:{touchstart:t.onKeyDown,touchend:t.onKeyUp}},[t.isMobile?n("span",{staticClass:"icon-arrow-left"}):n("span",[t._v("A")])]),n("button",{staticClass:"pad-button",attrs:{"data-key":"up"},on:{touchstart:t.onKeyDown,touchend:t.onKeyUp}},[t.isMobile?n("span",{staticClass:"icon-arrow-up"}):n("span",[t._v("W")])])]),n("div",{staticClass:"line"},[n("button",{staticClass:"pad-button",attrs:{"data-key":"down"},on:{touchstart:t.onKeyDown,touchend:t.onKeyUp}},[t.isMobile?n("span",{staticClass:"icon-arrow-down"}):n("span",[t._v("S")])]),n("button",{staticClass:"pad-button",attrs:{"data-key":"right"},on:{touchstart:t.onKeyDown,touchend:t.onKeyUp}},[t.isMobile?n("span",{staticClass:"icon-arrow-right"}):n("span",[t._v("D")])])])])]),n("div",{staticClass:"center"},[n("div",{staticClass:"displayer-wrap"},[n("canvas",{attrs:{id:"displayer",width:t.width,height:t.height}})]),n("div",{staticClass:"system-pad"},[n("button",{staticClass:"pad-button",attrs:{"data-key":"select",title:"F"},on:{touchstart:t.onKeyDown,touchend:t.onKeyUp}},[t._v("select")]),n("button",{staticClass:"pad-button",attrs:{"data-key":"start",title:"H"},on:{touchstart:t.onKeyDown,touchend:t.onKeyUp}},[t._v("start")])])]),n("div",{staticClass:"right"},[n("div",{staticClass:"action-pad"},[n("div",{staticClass:"button-wrap"},[n("button",{staticClass:"pad-button",attrs:{"data-key":"b",title:"K"},on:{touchstart:t.onKeyDown,touchend:t.onKeyUp}},[t._v("B")])]),n("div",{staticClass:"button-wrap"},[n("button",{staticClass:"pad-button",attrs:{"data-key":"a",title:"J"},on:{touchstart:t.onKeyDown,touchend:t.onKeyUp}},[t._v("A")])])])])])},s=[],u=(n("96cf"),n("4a1a")),c=n("d3ed"),l=n("238c"),f=n.n(l);function d(t){return new Promise(function(e,n){var a=new XMLHttpRequest;a.open("GET",t),a.overrideMimeType("text/plain; charset=x-user-defined"),a.addEventListener("load",function(){200===a.status?e(this.responseText):n(new Error(a.statusText))}),a.onerror=function(){n(new Error(a.statusText))},a.send()})}n("9c29"),n("6aa2");var h=n("9152"),p=n("3b60"),b=function(){function t(e,n){Object(h["a"])(this,t),this.canvas=null,this.ctx=null,this.w=e,this.h=n,this.screenImage=new ImageData(e,n),this.dataBuffer=new ArrayBuffer(this.screenImage.data.length),this.screenBuffer8=new Uint8ClampedArray(this.dataBuffer),this.screenBuffer32=new Uint32Array(this.dataBuffer)}return Object(p["a"])(t,[{key:"bindScreen",value:function(t){this.canvas=document.querySelector(t),this.ctx=this.canvas.getContext("2d")}},{key:"onFrame",value:function(t){for(var e=0;e<this.w*this.h;e++)this.screenBuffer32[e]=4278190080|t[e];this.screenImage.data.set(this.screenBuffer8),this.ctx.putImageData(this.screenImage,0,0)}}]),t}(),y=(n("63d9"),function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8820,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:44100;Object(h["a"])(this,t),this.audioContext=new AudioContext,this.bufferSize=e,this.leftBuffer=new Float32Array(e),this.rightBuffer=new Float32Array(e),this.bufferPtr=0,this.lastPtr=this.bufferPtr,this.audioBuffer=this.audioContext.createBuffer(2,e,n)}return Object(p["a"])(t,[{key:"writeSampleBuffer",value:function(t,e){this.leftBuffer[this.bufferPtr]=t,this.rightBuffer[this.bufferPtr]=e,this.bufferPtr++,this.bufferPtr>=this.bufferSize&&this.playAudio()}},{key:"playAudio",value:function(){var t=this.audioContext.createBufferSource();this.audioBuffer.copyToChannel(this.leftBuffer,0,0),this.audioBuffer.copyToChannel(this.rightBuffer,1,0),t.buffer=this.audioBuffer,t.connect(this.audioContext.destination),t.start(),this.bufferPtr=0}}]),t}()),v=function(){function t(e){Object(h["a"])(this,t),this.keyTable=e||{w:"up",a:"left",d:"right",s:"down",f:"select",h:"start",j:"a",k:"b"}}return Object(p["a"])(t,[{key:"updateKeyTable",value:function(t){this.keyTable=t}},{key:"convertKey",value:function(t){return t?c["Controller"]["BUTTON_"+t.toUpperCase()]:null}}]),t}(),w=256,m=240,g=new b(w,m),C=new y,k=new c["NES"]({onFrame:function(t){return g.onFrame(t)},onAudioSample:function(t,e){return C.writeSampleBuffer(t,e)}}),K=new v(null,k),x={data:function(){return{width:w,height:m,isMobile:new f.a(window.navigator.userAgent).mobile()}},mounted:function(){this.init(),document.onkeydown=this.onKeyDown,document.onkeyup=this.onKeyUp,document.onkeypress=this.onKeypress},methods:{getKey:function(t){var e=t.key;return e=K.keyTable[e]||t.target.dataset.key,e=K.convertKey(e),e},onKeyDown:function(t){k.buttonDown(1,this.getKey(t))},onKeyUp:function(t){k.buttonUp(1,this.getKey(t)),window.navigator.vibrate(100)},init:function(){var t=Object(u["a"])(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return g.bindScreen("#displayer"),t.next=3,d("./马里奥.nes");case 3:e=t.sent,k.loadROM(e),this.loop();case 6:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),loop:function(){var t=this;requestAnimationFrame(function(){k.frame(),t.loop()})}}},B=x,_=(n("bb2a"),n("2877")),S=Object(_["a"])(B,o,s,!1,null,"0284b292",null);S.options.__file="MainPlayer.vue";var O=S.exports;function j(t){var e=t.requestFullScreen||t.webkitRequestFullScreen||t.mozRequestFullScreen||t.msRequestFullScreen;e?e.call(t):alert("您的浏览器太旧了，请升级浏览器后再试")}var P={name:"app",components:{MainPlayer:O},mounted:function(){var t=new f.a(window.navigator.userAgent);t.mobile()&&(document.onclick=function(){j(document.querySelector("#app"))})}},M=P,T=(n("7c55"),Object(_["a"])(M,r,i,!1,null,null,null));T.options.__file="App.vue";var A=T.exports;a["a"].config.productionTip=!1,new a["a"]({render:function(t){return t(A)}}).$mount("#app")},"7c55":function(t,e,n){"use strict";var a=n("8b81"),r=n.n(a);r.a},"8b81":function(t,e,n){},bb2a:function(t,e,n){"use strict";var a=n("50db"),r=n.n(a);r.a}});
//# sourceMappingURL=app.225fafa3.js.map