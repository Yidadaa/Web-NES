(function(t){function e(e){for(var r,i,s=e[0],u=e[1],c=e[2],l=0,d=[];l<s.length;l++)i=s[l],a[i]&&d.push(a[i][0]),a[i]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(t[r]=u[r]);f&&f(e);while(d.length)d.shift()();return o.push.apply(o,c||[]),n()}function n(){for(var t,e=0;e<o.length;e++){for(var n=o[e],r=!0,s=1;s<n.length;s++){var u=n[s];0!==a[u]&&(r=!1)}r&&(o.splice(e--,1),t=i(i.s=n[0]))}return t}var r={},a={app:0},o=[];function i(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=r,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],u=s.push.bind(s);s.push=e,s=s.slice();for(var c=0;c<s.length;c++)e(s[c]);var f=u;o.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"4c93":function(t,e,n){},5457:function(t,e,n){"use strict";var r=n("4c93"),a=n.n(r);a.a},"56d7":function(t,e,n){"use strict";n.r(e);n("cadf"),n("551c"),n("097d");var r=n("2b0e"),a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("MainPlayer"),n("div",{staticClass:"tip"},[t._v("请旋转屏幕")])],1)},o=[],i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"player"}},[n("div",{staticClass:"left"},[n("div",{staticClass:"direction-pad"},[n("div",{staticClass:"line"},[n("button",{staticClass:"pad-button",attrs:{"data-key":"left"},on:{touchstart:t.onKeyDown,touchend:t.onKeyUp}},[t._v("A")]),n("button",{staticClass:"pad-button",attrs:{"data-key":"up"},on:{touchstart:t.onKeyDown,touchend:t.onKeyUp}},[t._v("W")])]),n("div",{staticClass:"line"},[n("button",{staticClass:"pad-button",attrs:{"data-key":"down"},on:{touchstart:t.onKeyDown,touchend:t.onKeyUp}},[t._v("D")]),n("button",{staticClass:"pad-button",attrs:{"data-key":"right"},on:{touchstart:t.onKeyDown,touchend:t.onKeyUp}},[t._v("S")])])])]),n("div",{staticClass:"center"},[n("div",{staticClass:"displayer-wrap"},[n("canvas",{attrs:{id:"displayer",width:t.width,height:t.height}})]),n("div",{staticClass:"system-pad"},[n("button",{staticClass:"pad-button",attrs:{"data-key":"select"},on:{touchstart:t.onKeyDown,touchend:t.onKeyUp}},[t._v("select")]),n("button",{staticClass:"pad-button",attrs:{"data-key":"start"},on:{touchstart:t.onKeyDown,touchend:t.onKeyUp}},[t._v("start")])])]),n("div",{staticClass:"right"},[n("div",{staticClass:"action-pad"},[n("button",{staticClass:"pad-button",attrs:{"data-key":"b"},on:{touchstart:t.onKeyDown,touchend:t.onKeyUp}},[t._v("B")]),n("button",{staticClass:"pad-button",attrs:{"data-key":"a"},on:{touchstart:t.onKeyDown,touchend:t.onKeyUp}},[t._v("A")])])])])},s=[],u=(n("96cf"),n("4a1a")),c=n("d3ed");function f(t){return new Promise(function(e,n){var r=new XMLHttpRequest;r.open("GET",t),r.overrideMimeType("text/plain; charset=x-user-defined"),r.addEventListener("load",function(){200===r.status?e(this.responseText):n(new Error(r.statusText))}),r.onerror=function(){n(new Error(r.statusText))},r.send()})}n("9c29"),n("6aa2");var l=n("9152"),d=n("3b60"),h=function(){function t(e,n){Object(l["a"])(this,t),this.canvas=null,this.ctx=null,this.w=e,this.h=n,this.screenImage=new ImageData(e,n),this.dataBuffer=new ArrayBuffer(this.screenImage.data.length),this.screenBuffer8=new Uint8ClampedArray(this.dataBuffer),this.screenBuffer32=new Uint32Array(this.dataBuffer)}return Object(d["a"])(t,[{key:"bindScreen",value:function(t){this.canvas=document.querySelector(t),this.ctx=this.canvas.getContext("2d")}},{key:"onFrame",value:function(t){for(var e=0;e<this.w*this.h;e++)this.screenBuffer32[e]=4278190080|t[e];this.screenImage.data.set(this.screenBuffer8),this.ctx.putImageData(this.screenImage,0,0)}}]),t}(),p=(n("63d9"),function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8820,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:44100;Object(l["a"])(this,t),this.audioContext=new AudioContext,this.bufferSize=e,this.leftBuffer=new Float32Array(e),this.rightBuffer=new Float32Array(e),this.bufferPtr=0,this.lastPtr=this.bufferPtr,this.audioBuffer=this.audioContext.createBuffer(2,e,n)}return Object(d["a"])(t,[{key:"writeSampleBuffer",value:function(t,e){this.leftBuffer[this.bufferPtr]=t,this.rightBuffer[this.bufferPtr]=e,this.bufferPtr++,this.bufferPtr>=this.bufferSize&&this.playAudio()}},{key:"playAudio",value:function(){var t=this.audioContext.createBufferSource();this.audioBuffer.copyToChannel(this.leftBuffer,0,0),this.audioBuffer.copyToChannel(this.rightBuffer,1,0),t.buffer=this.audioBuffer,t.connect(this.audioContext.destination),t.start(),this.bufferPtr=0}}]),t}()),y=function(){function t(e){Object(l["a"])(this,t),this.keyTable=e||{w:"up",a:"left",d:"right",s:"down",f:"select",h:"start",j:"a",k:"b"}}return Object(d["a"])(t,[{key:"updateKeyTable",value:function(t){this.keyTable=t}},{key:"convertKey",value:function(t){return t?c["Controller"]["BUTTON_"+t.toUpperCase()]:null}}]),t}(),v=256,b=240,w=new h(v,b),m=new p,g=new c["NES"]({onFrame:function(t){return w.onFrame(t)},onAudioSample:function(t,e){return m.writeSampleBuffer(t,e)}}),k=new y(null,g),C={data:function(){return{width:v,height:b}},mounted:function(){this.init(),document.onkeydown=this.onKeyDown,document.onkeyup=this.onKeyUp,document.onkeypress=this.onKeypress},methods:{getKey:function(t){var e=t.key;return e=k.keyTable[e]||t.target.dataset.key,e=k.convertKey(e),e},onKeyDown:function(t){g.buttonDown(1,this.getKey(t))},onKeyUp:function(t){g.buttonUp(1,this.getKey(t)),window.navigator.vibrate(100)},init:function(){var t=Object(u["a"])(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return w.bindScreen("#displayer"),t.next=3,f("./马里奥.nes");case 3:e=t.sent,g.loadROM(e),this.loop();case 6:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),loop:function(){var t=this;requestAnimationFrame(function(){g.frame(),t.loop()})}}},K=C,x=(n("5457"),n("2877")),B=Object(x["a"])(K,i,s,!1,null,"73099892",null);B.options.__file="MainPlayer.vue";var _=B.exports,S=n("238c"),O=n.n(S);function j(t){var e=t.requestFullScreen||t.webkitRequestFullScreen||t.mozRequestFullScreen||t.msRequestFullScreen;e?e.call(t):alert("您的浏览器太旧了，请升级浏览器后再试")}var P={name:"app",components:{MainPlayer:_},mounted:function(){var t=new O.a(window.navigator.userAgent);t.mobile()&&(document.onclick=function(){j(document.querySelector("#app"))})}},T=P,U=(n("7c55"),Object(x["a"])(T,a,o,!1,null,null,null));U.options.__file="App.vue";var A=U.exports;r["a"].config.productionTip=!1,new r["a"]({render:function(t){return t(A)}}).$mount("#app")},"7c55":function(t,e,n){"use strict";var r=n("8b81"),a=n.n(r);a.a},"8b81":function(t,e,n){}});
//# sourceMappingURL=app.dd079f1e.js.map